<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>SQL Judge Test</title>
    <style>
        body { font-family: Arial; max-width: 900px; margin: 40px auto; }
        textarea { width: 100%; height: 120px; margin-top: 10px; }
        select, button { padding: 8px; margin-top: 10px; }
        .box { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 15px; }
        pre { background: #222; color: #0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>

<h2>ğŸ§  SQL Online Judge Tester</h2>

<label>Chá»n bÃ i:</label>
<select id="problemSelect"></select>

<div class="box">
    <h3>ğŸ“˜ MÃ´ táº£ bÃ i</h3>
    <div id="description">Äang táº£i...</div>
</div>

<h3>âœï¸ Nháº­p SQL cá»§a báº¡n</h3>
<textarea id="sqlInput" placeholder="SELECT * FROM users;"></textarea>

<button onclick="submitSQL()">Cháº¥m bÃ i</button>

<div class="box">
    <h3>ğŸ“Š Káº¿t quáº£</h3>
    <pre id="result">ChÆ°a cháº¥m...</pre>
</div>

<script>
const API = "http://localhost:8080/api";

// Load danh sÃ¡ch Ä‘á»
async function loadProblems() {
    const res = await fetch(API + "/problems");
    const data = await res.json();
    const select = document.getElementById("problemSelect");

    data.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name;
        select.appendChild(opt);
    });

    loadProblemDetail();
}

// Load chi tiáº¿t Ä‘á»
async function loadProblemDetail() {
    const id = document.getElementById("problemSelect").value;
    const res = await fetch(API + "/problems/" + id);
    const data = await res.json();
    document.getElementById("description").textContent = data.description;
}

document.getElementById("problemSelect").addEventListener("change", loadProblemDetail);

// Gá»­i SQL Ä‘á»ƒ cháº¥m
async function submitSQL() {
    const id = document.getElementById("problemSelect").value;
    const sql = document.getElementById("sqlInput").value;

    const res = await fetch(API + "/judge", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ problem_id: parseInt(id), sql: sql })
    });

    const data = await res.json();
    let resultText = `Passed: ${data.passed} / ${data.total}`;
    
    if (data.details && data.details.length > 0) {
        resultText += "\n\nErrors:\n" + data.details.join("\n");
    }
    
    document.getElementById("result").textContent = resultText;
}

loadProblems();
</script>

</body>
</html>
